/*!CK:3350723285!*//*1418016241,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["jORT4"]); }

__d("UnicodeUppercase",[],function(a,b,c,d,e,f){e.exports={uppercase:"\\u0041-\\u005a\\u03fd-\\u042f\\u00c0-\\u00d6\\u0531-\\u0556\\u0110\\u00d8-\\u00de\\u011e\\u0130\\u015e\\u01ae-\\u01af\\uff21-\\uff3a\\u1ea2\\u0391-\\u03a1\\u03a3-\\u03ab"};},null);
__d("htmlize",["htmlSpecialChars"],function(a,b,c,d,e,f,g){function h(i){return g(i).replace(/\r\n|[\r\n]/g,'<br/>');}e.exports=h;},null);
__d("MentionsInputMatchers",["MentionsAlphabetExperiment","UnicodeUppercase"],function(a,b,c,d,e,f,g,h){var i,j;if(g.use_non_latin_characters){i='(?:^|\\s)';j=h.uppercase;}else{i='\\b';j='A-Z';}var k=['@','\\uff20'].join(''),l=['#','\\uFF03'].join(''),m='.,+*?$|#{}()\\^\\-\\[\\]\\\\\/!%\'"~=<>_:;\n\r',n=m.replace('#','')+'&';function o(r,s){"use strict";this.$Matchers0=r;this.$Matchers1=s;this.$Matchers2();}o.prototype.$Matchers2=function(){"use strict";var r=this.$Matchers3(this.$Matchers1),s=this.$Matchers4(this.$Matchers0,this.$Matchers1),t=this.$Matchers5(this.$Matchers0,s),u=this.$Matchers6(r,t),v=this.$Matchers7(r);this.$Matchers8=new RegExp('['+this.$Matchers0+']$');this.$Matchers9=new RegExp(t+'$');this.$Matchersa=new RegExp(v+'$');this.$Matchersb=new RegExp(u+'$');this.$Matchersc=new RegExp('['+l+']');};o.prototype.$Matchers3=function(r){"use strict";return i+'['+j+'][^ '+j+r+']';};o.prototype.$Matchers4=function(r,s){"use strict";return '(?:[^'+r+s+']|['+s+'][^ '+s+'])';};o.prototype.$Matchers5=function(r,s){"use strict";return '(?:^|\\s)(?:['+r+']('+s+'{0,20}))';};o.prototype.$Matchers6=function(r,s){"use strict";return '(?:(?:^|[^#])('+r+'+)|'+s+')';};o.prototype.$Matchers7=function(r){"use strict";return '(?:'+r+'{4,})';};o.prototype.getMainMatcher=function(){"use strict";return this.$Matchers9;};o.prototype.getTriggerMatcher=function(){"use strict";return this.$Matchers8;};o.prototype.getAutoMatcher=function(){"use strict";return this.$Matchersb;};o.prototype.getHashtagMatcher=function(){"use strict";return this.$Matchersc;};var p=i+'['+j+'][^ '+j+m+']',q={mentionsMatchers:new o(k,m),hashtagMatchers:new o(l,n),userMatcher:new RegExp('(?:'+p+'{4,})'+'$')};e.exports=q;},null);
__d("MentionsInput",["Arbiter","ArbiterMixin","Bootloader","CSS","DataStore","DOM","Event","FlipDirection","Input","InputSelection","Keys","MentionsInputMatchers","Parent","Style","TokenizeUtil","UserAgent_DEPRECATED","htmlize","mixin","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z='\uFEFF',aa=new RegExp(z,'g'),ba=function(oa){return oa+z;},ca='\uFFFD',da=/@+\[[0-9]+\:([^\]]|\\\])*\]+/g,ea=/[\\\]:]/g,fa={MENTIONS:'mentions',HASHTAGS:'hashtags'};function ga(oa,pa){return oa.replace(pa,' '.repeat(pa.length));}function ha(oa,pa){return oa.substring(0,pa)+oa.substring(pa+1);}function ia(oa){var pa=oa.lastIndexOf('>');if(pa>=0){var qa=oa.indexOf(' ',pa);return qa>=0?oa.substr(0,qa+1):oa;}else return '';}function ja(oa,pa,qa){var ra=qa.lastIndexOf('<',pa)>qa.lastIndexOf('>',pa);return ra?' ':'&nbsp;<wbr />';}var ka=x(h);for(var la in ka)if(ka.hasOwnProperty(la))na[la]=ka[la];var ma=ka===null?null:ka.prototype;na.prototype=Object.create(ma);na.prototype.constructor=na;na.__superConstructor__=ka;function na(oa,pa,qa,ra,sa,ta){"use strict";k.set(oa,'MentionsInput',this);this._root=oa;this._typeahead=pa;this._input=qa;this._offsets=[];var ua=null,va=this.init.bind(this,ra,sa,ta);try{ua=document.activeElement===this._input;}catch(wa){}if(ua){setTimeout(va,0);}else var xa=m.listen(this._input,'focus',function(){setTimeout(va,0);xa.remove();});this._hasHashtags=ra.hashtags;this._hashtagsDataSource=ra.hashtags_data_source;this._mentionsDataSource=this._typeahead.getData();this._currentDataSource=this._mentionsDataSource;this._autoSuggestPages=ra.autosuggest_pages;this._lastHighlighterHTML='';this._hashtags=[];this._matchers=r.mentionsMatchers;this._setMatchersMode(fa.MENTIONS);}na.prototype.init=function(oa,pa,qa){"use strict";if(this._initialized)return;this._initValue=pa?pa.value:'';this._initialized=true;this._highlighter=l.find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=l.find(this._root,'.highlighterContent');this._hiddenInput=l.find(this._root,'.mentionsHidden');this._placeholder=this._input.getAttribute('placeholder')||'';this._metrics=qa;if(!this._hiddenInput.name){var ra=this._input.name;this._input.name=ra+'_text';this._hiddenInput.name=ra;}this._initEvents();this._initTypeahead();if(pa===null){this._setup();}else this.reset(pa);if(oa.autoheight)this._typeahead.setHeight&&this._typeahead.setHeight('auto');this.inform('init',null,g.BEHAVIOR_STATE);};na.prototype._setup=function(){"use strict";this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._highlighterContent&&l.empty(this._highlighterContent);this._highlighterAuxContent&&l.remove(this._highlighterAuxContent);this._highlighterAuxContent=null;o.setPlaceholder(this._input,this._placeholder);t.set(this._typeahead.getElement(),'height','auto');};na.prototype.reset=function(oa){"use strict";if(!this._initialized)return;this._setup();var pa=oa&&oa.value||'';this._value=pa;this._hiddenInput&&(this._hiddenInput.value=pa);if(this._input&&oa)o.setValue(this._input,oa.value);var qa=oa&&oa.mentions;if(qa&&qa.length){var ra=[];qa.forEach(function(sa){ra.push(sa.offset+sa.length);delete sa.offset;delete sa.length;this._addToken(sa);},this);ra.reverse().forEach(function(sa){pa=pa.substring(0,sa)+z+pa.substring(sa);});}o.setValue(this._input,pa);if(this._value==='')n.setDirection(this._input);this._update();};na.prototype.getValue=function(){"use strict";return o.getValue(this._input).replace(aa,'');};na.prototype._getMarkedValue=function(){"use strict";return o.getValueRaw(this._input);};na.prototype.getRawValue=function(){"use strict";this._update();return o.getValue(this._hiddenInput);};na.prototype.checkValue=function(){"use strict";var oa=this._typeahead.getCore().getValue();if(this._matchers.getTriggerMatcher().exec(oa)||oa==='')this.inform('sessionEnd',{});};na.prototype.getTypeahead=function(){"use strict";return this._typeahead;};na.prototype.hasChanges=function(){"use strict";return !o.isEmpty(this._input)&&this._input.value!==this._initValue&&this._initialized;};na.prototype._initEvents=function(){"use strict";var oa=this._update.bind(this);m.listen(this._input,{input:oa,keyup:oa,change:oa,blur:this._handleBlur.bind(this),focus:this._handleFocus.bind(this),keydown:this._handleKeydown.bind(this)});if(this._metrics){this._metrics.init(this._typeahead);this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);m.listen(this._input,'keyup',function(event){setTimeout(this.checkValue.bind(this),0);}.bind(this));}};na.prototype._initTypeahead=function(){"use strict";this._typeahead.subscribe('select',function(ta,ua){var va=ua.selected;this._addToken({uid:va.uid,text:va.text,type:va.type,weakreference:va.weak_reference});this.updateValue();}.bind(this));var oa=this._input,pa=null;function qa(){if(pa===null){pa=o.getSubmitOnEnter(oa);o.setSubmitOnEnter(oa,false);}}function ra(){if(pa!==null){o.setSubmitOnEnter(oa,pa);pa=null;}}this._typeahead.subscribe('reset',ra);this._typeahead.subscribe('render',qa);this._typeahead.subscribe('highlight',function(ta,ua){ua.index>=0?qa():ra();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));var sa=this._typeahead.getCore();sa.suffix=z;this._handleFocus();};na.prototype._handleBlur=function(){"use strict";if(this._filterToken){this._filterToken.remove();this._filterToken=null;}};na.prototype._handleFocus=function(){"use strict";if(!this._filterToken)this._filterToken=this._typeahead.getData().addFilter(this._filterResults.bind(this));this._updateWidth();};na.prototype._handleKeydown=function(event){"use strict";var oa=event.keyCode;if(oa==q.BACKSPACE||oa==q.DELETE)this._handleBackspaceAndDelete(event,oa);if(oa==q.LEFT||oa==q.RIGHT)setTimeout(this._handleLeftAndRight.bind(this,oa),10);};na.prototype._handleLeftAndRight=function(oa){"use strict";var pa=this._getMarkedValue(),qa=p.get(this._input),ra=qa.start,sa=qa.end,ta=oa==q.LEFT,ua=oa==q.RIGHT;if(ra==sa){var va=ta?-1:1;if(pa.charAt(ra)==z)p.set(this._input,ra+va);}else if(ta&&pa.charAt(ra)==z){p.set(this._input,ra-1,sa);}else if(ta&&pa.charAt(sa)==z){p.set(this._input,ra,sa-1);}else if(ua&&pa.charAt(sa)==z){p.set(this._input,ra,sa+1);}else if(ua&&pa.charAt(ra)==z)p.set(this._input,ra+1,sa);};na.prototype._handleBackspaceAndDelete=function(event,oa){"use strict";var pa=p.get(this._input),qa=false;if(pa.start!==pa.end)if(this._offsetIsInsideMention(pa.start+1)&&this._offsetIsInsideMention(pa.end)){qa=(oa===q.BACKSPACE);}else return;var ra=oa===q.DELETE?1:-1,sa=ra+(qa?pa.end:pa.start),ta=this._getMarkedValue(),ua=ta;for(var va=0;va<this._orderedUIDs.length;++va){var wa=this._mentioned[this._orderedUIDs[va]],xa=wa.text,ya=ba(xa),za=ua.indexOf(ya),ab=za+ya.length;if(sa<za||sa>=ab){ua=ga(ua,ya);continue;}var bb,cb;if(wa.type!='user'){bb=0;cb=[xa];}else{bb=ya.substring(0,sa-za).split(' ').length-1;cb=xa.split(' ');}var db=cb.splice(bb,1)[0],eb=cb.join(' '),fb=bb===0?za:ab-db.length-1;if(eb){wa.text=eb;eb=ba(eb);}else this._removeToken(wa.uid);var gb=ta.substring(0,za)+eb+ta.substring(ab);o.setValue(this._input,gb);p.set(this._input,fb);this._update();event.kill();break;}};na.prototype._offsetIsInsideMention=function(oa){"use strict";for(var pa=0;pa<this._offsets.length;pa++)if(oa>this._offsets[pa][0]&&oa<=this._offsets[pa][1])return true;return false;};na.prototype._filterResults=function(oa){"use strict";if(this._filterData===null){var pa=p.get(this._input).start;if(this._offsetIsInsideMention(pa)){this._filterData={caretIsInsideMention:true};return false;}var qa=this._typeahead.getCore();this._filterData={value:qa.getValue(),rawValue:qa.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(this._matchers.getMainMatcher().test(this._filterData.rawValue))return true;if(oa.type!='user'&&!this._shouldIncludeNonUserItem(oa))return false;if(oa.disable_autosuggest)return false;if(this._matchersMode===fa.MENTIONS&&r.userMatcher.test(this._filterData.value))return true;return u.isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(oa));};na.prototype._shouldIncludeNonUserItem=function(oa){"use strict";if(this._autoSuggestPages!='false'&&oa.connected_page)return true;if(this._autoSuggestPages=='include_authoritative'&&oa.is_authoritative_person)return true;return false;};na.prototype._addToken=function(oa){"use strict";var pa=oa.uid;if(!this._mentioned.hasOwnProperty(pa)){this._mentioned[pa]=oa;var qa=this._orderedUIDs,ra=this._getMarkedValue().replace(da,ca),sa=ra.indexOf(ba(this._mentioned[pa].text)),ta=false,ua=0;for(var va=0;va<qa.length;++va){var wa=ba(this._mentioned[qa[va]].text),xa=ra.indexOf(wa,ua);ua=xa+wa.length;if(sa<xa){this._orderedUIDs.splice(va,0,pa);ta=true;break;}}if(!ta)this._orderedUIDs.push(pa);this._numMentioned++;this._update();}};na.prototype._removeToken=function(oa){"use strict";if(this._mentioned.hasOwnProperty(oa)){delete this._mentioned[oa];y(this._orderedUIDs,oa);this._numMentioned--;this._update();}};na.prototype._update=function(){"use strict";var oa=this._getMarkedValue();this._checkShouldSwapDataSource(oa);if(oa==this._value)return;this._value=oa;this._updateTypeahead();this._updateMentions();this._updateWidth();setTimeout(this._updateDirection.bind(this),0);this.updateValue();var pa=this.hasAuxContent();this.inform('valueUpdate',{value:oa,hasAuxContent:pa});};na.prototype._updateMentions=function(){"use strict";this._offsets=[];var oa=this._getMarkedValue(),pa=oa;for(var qa=0;qa<this._orderedUIDs.length;++qa){var ra=this._orderedUIDs[qa],sa=ba(this._mentioned[ra].text),ta=pa.indexOf(sa);if(ta==-1)this._removeToken(ra);pa=ga(pa,sa);this._offsets.push([ta,ta+sa.length]);}var ua=oa;while((ta=pa.indexOf(z))>-1){ua=ha(ua,ta);pa=ha(pa,ta);}if(oa!==ua){var va=p.get(this._input);o.setValue(this._input,ua);p.set(this._input,va.start);this._value=ua;}};na.prototype._renderHashtags=function(oa){"use strict";this._initHashtagParser(oa);if(!this._hasHashtags||!this._hashtagParser)return w(oa);this._hashtags=this._hashtagParser.parse(oa);var pa=[],qa=0;for(var ra=0;ra<this._hashtags.length;ra++){var sa=this._hashtags[ra];pa.push(w(oa.substring(qa,sa.rawOffset)),'<b>',sa.marker,sa.tag,'</b>');qa=sa.rawOffset+sa.marker.length+sa.tag.length;}pa.push(w(oa.substring(qa)));return pa.join('');};na.prototype.updateValue=function(){"use strict";var oa=this._value=this._getMarkedValue(),pa=this._orderedUIDs,qa=oa.replace(da,ca);for(var ra=0;ra<pa.length;++ra){var sa='@['+pa[ra]+':]',ta=ba(this._mentioned[pa[ra]].text);qa=qa.replace(ta,sa);oa=oa.replace(ta,sa);}var ua=this._renderHashtags(oa);for(var ra=0;ra<pa.length;++ra){var va=pa[ra],wa=this._mentioned[va],xa=wa.text,ya=wa.weakreference?'<b class="weak">':'<b>';ua=ua.replace('@['+va+':]',ya+w(ba(xa))+'</b>');xa=xa.replace(ea,function(ab){return '\\'+ab;});qa=qa.replace('@['+va+':]','@['+va+':'+xa+']');}var za=ia(ua);if(this._highlighterAuxContent||za!==this._lastHighlighterHTML){if(v.ie()<9)ua=ua.replace(/ /g,ja);this._highlighterContent.innerHTML=ua;this._updateHighlighter();this._lastHighlighterHTML=za;}this._hiddenInput.value=qa;this._updateHeight();};na.prototype._updateDirection=function(){"use strict";var oa=t.get(this._input,'direction');if(oa==this._dir)return;this._dir=oa;t.set(this._highlighter,'direction',oa);if(oa=='rtl'){t.set(this._highlighter,'text-align','right');}else t.set(this._highlighter,'text-align','left');};na.prototype._updateWidth=function(){"use strict";var oa=this._input.offsetWidth;if(oa===this._lastInputWidth)return;this._lastInputWidth=oa;var pa=t.getFloat.bind(null,this._input),qa=oa-pa('paddingLeft')-pa('paddingRight')-pa('borderLeftWidth')-pa('borderRightWidth');this._highlighterInner.style.width=Math.max(qa,0)+'px';};na.prototype._updateHeight=function(){"use strict";if(this._highlighterAuxContent){var oa=this._highlighter.offsetHeight,pa=this._typeahead.getElement();if(oa>pa.offsetHeight){if(this._typeahead.setHeight){this._typeahead.setHeight(oa);}else t.set(pa,'height',oa+'px');g.inform('reflow');}}};na.prototype._updateTypeahead=function(){"use strict";var oa=this._typeahead.getCore();oa.matcher=this._matchers.getAutoMatcher();oa.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});};na.prototype.setPlaceholder=function(oa){"use strict";this._placeholder=oa;if(!this.hasAuxContent())o.setPlaceholder(this._input,oa);};na.prototype._updateHighlighter=function(){"use strict";if(this._highlighterContent)j.conditionShow(this._highlighterContent,this._numMentioned>0||this.hasAuxContent()||this._hashtags.length);};na.prototype.setAuxContent=function(oa){"use strict";if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=l.create('span',{className:'highlighterAuxContent'});l.insertAfter(this._highlighterContent,this._highlighterAuxContent);}l.setContent(this._highlighterAuxContent,oa);if(oa){o.setPlaceholder(this._input,'');}else o.setPlaceholder(this._input,this._placeholder);this._value=null;this._update();this._updateHighlighter();this._updateHeight();}};na.prototype.hasAuxContent=function(){"use strict";var oa=this.getAuxContentRoot();return oa&&j.shown(oa)&&oa.innerHTML.length>0;};na.prototype.getAuxContentRoot=function(){"use strict";return this._highlighterAuxContent;};na.prototype.addMention=function(oa,pa){"use strict";pa=(typeof pa==='undefined')?true:pa;var qa=pa===false?'':' ',ra=this._getMarkedValue();if(ra!=='')ra+=' ';o.setValue(this._input,ra+ba(oa.text)+qa);this._addToken(oa);this._update();};na.prototype.getMentions=function(){"use strict";return this._mentioned;};na.prototype.bootloadHashtagParser=function(){"use strict";if(!this._hashtagParser)i.loadModules(["HashtagParser"],function(oa){this._hashtagParser=oa;if(this._initialized){this._value=null;this._update();}}.bind(this));};na.getInstance=function(oa){"use strict";var pa=s.byClass(oa,'uiMentionsInput');return pa?k.get(pa,'MentionsInput'):null;};na.prototype._checkShouldSwapDataSource=function(oa){"use strict";this._initHashtagParser(oa);if(!this._hashtagsDataSource||!this._hashtagParser)return;var pa=this._isInsideHashtagToken(oa);if(this._matchersMode===fa.HASHTAGS&&!pa){this._setMatchersMode(fa.MENTIONS);this._swapData(this._mentionsDataSource);}else if(this._matchersMode===fa.MENTIONS&&pa){this._setMatchersMode(fa.HASHTAGS);this._swapData(this._hashtagsDataSource);}};na.prototype._swapData=function(oa){"use strict";this._currentDataSource=oa;this._typeahead.swapDataNoCoreReset(this._currentDataSource);};na.prototype._isInsideHashtagToken=function(oa){"use strict";this._hashtags=this._hashtagParser.parse(oa);var pa=p.get(this._input).start;for(var qa=0;qa<this._hashtags.length;qa++){var ra=this._hashtags[qa],sa=ra.offset;if(pa>=sa&&pa<=(sa+ra.tag.length+1))return true;}return false;};na.prototype._initHashtagParser=function(oa){"use strict";if(this._hashtagParser)return;if(this._matchers.getHashtagMatcher().exec(oa))this.bootloadHashtagParser();};na.prototype._setMatchersMode=function(oa){"use strict";switch(oa){case fa.MENTIONS:this._matchers=r.mentionsMatchers;break;case fa.HASHTAGS:this._matchers=r.hashtagMatchers;break;default:throw new Error('Invariant Violation: MatchersMode enum is missing constant '+oa);}this._matchersMode=oa;};e.exports=na;},null);
__d("legacy:MentionsInput",["MentionsInput"],function(a,b,c,d){a.MentionsInput=b('MentionsInput');},3);
__d("TypeaheadAreaCore",["InputSelection","TextAreaControl","TypeaheadCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k){for(var l in i)if(i.hasOwnProperty(l))n[l]=i[l];var m=i===null?null:i.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=i;function n(o){"use strict";i.call(this,o);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}n.prototype.select=function(o){"use strict";m.select.call(this,o);var p=this.element.value,q=this.prefix+o.text+this.suffix;this.expandBounds(p,q);var r=p.substring(0,this.start),s=p.substring(this.end);this.element.value=r+q+s;g.set(this.element,r.length+q.length);};n.prototype.expandBounds=function(o,p){"use strict";o=o.toLowerCase();p=p.toLowerCase();var q,r,s,t,u=/\s/;r=o.substring(this.start,this.end);s=p.indexOf(r);q=this.start;while(q>=0&&s>=0){t=o.charAt(q-1);if(!t||u.test(t))this.start=q;r=t+r;s=p.indexOf(r);q--;}r=o.substring(this.start,this.end);s=p.indexOf(r);q=this.end;while(q<=o.length&&s>=0){t=o.charAt(q);if(!t||u.test(t))this.end=q;r=r+t;s=p.indexOf(r);q++;}};n.prototype.getRawValue=function(){"use strict";var o=g.get(this.element).start||0;return m.getValue.call(this).substring(0,o);};n.prototype.getValue=function(){"use strict";var o=this.matcher&&this.matcher.exec(this.getRawValue());if(!o)return '';var p=o[0],q=o.index+p.length;p=p.replace(/^\s/,'');var r=p.length;p=p.replace(/\s$/,'');var s=r-p.length;this.start=q-r;this.end=q+s;return o[2]||o[1]||o[0];};n.prototype.setHeight=function(o){"use strict";m.setHeight.call(this,o);var p=h.getInstance(this.element);p.updateHeight();};j(n.prototype,{prefix:'',suffix:', ',matcher:"\\b[^,]*",click:k});e.exports=n;},null);
__d("TypeaheadHoistFriends",["copyProperties"],function(a,b,c,d,e,f,g){function h(i){"use strict";this._typeahead=i;}h.prototype.enable=function(){"use strict";var i=this._typeahead.getView();this._subscription=i.subscribe('beforeRender',function(j,k){var l=[],m=[],n=[];for(var o=0;o<k.results.length;++o){var p=k.results[o];if(p.type=='header'){n=n.concat(m,l);n.push(p);m=[];l=[];}else if(p.type=='user'&&p.bootstrapped){m.push(p);}else l.push(p);}k.results=n.concat(m,l);});};h.prototype.disable=function(){"use strict";this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;};g(h.prototype,{_subscription:null});e.exports=h;},null);
__d("legacy:HoistFriendsTypeaheadBehavior",["TypeaheadHoistFriends"],function(a,b,c,d,e,f,g){if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.hoistFriends=function(h){h.enableBehavior(g);};},3);
__d("QueriesHistory",[],function(a,b,c,d,e,f){function g(h){"use strict";this.$QueriesHistory0=h;this.reset();}g.prototype.getQueries=function(){"use strict";return this.$QueriesHistory1;};g.prototype.getCurrentLength=function(){"use strict";return this.$QueriesHistory2;};g.prototype.add=function(h){"use strict";this.$QueriesHistory1.push(h);this.$QueriesHistory2+=h.length;while(this.$QueriesHistory1.length!==0&&this.$QueriesHistory2>this.$QueriesHistory0){var i=this.$QueriesHistory1.shift();this.$QueriesHistory2-=i.length;}};g.prototype.reset=function(){"use strict";this.$QueriesHistory2=0;this.$QueriesHistory1=[];};e.exports=g;},null);
__d("TypeaheadMetrics",["AsyncRequest","Event","QueriesHistory","copyProperties","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k){var l=1000;function m(n){"use strict";this.extraData={};j(this,n);}m.prototype.init=function(n){"use strict";this.init=k;this.core=n.getCore();this.view=n.getView();this.data=n.getData();this.queriesHistory=new i(l);this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();};m.prototype._reset=function(){"use strict";this.stats={};this.avgStats={};this.sessionActive=false;this.sid=Math.floor(Date.now()*Math.random());this.data.setQueryData({sid:this.sid});this.data.setBootstrapData({sid:this.sid});this.request_ids=[];this.lastNotBackspacedQuery='';this.queriesHistory.reset();};m.prototype.recordSelect=function(n){"use strict";var o=n.selected;if(o.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',o.uid);this.recordStat('selected_type',o.type);this.recordStat('selected_score',o.score);this.recordStat('selected_original_id',o.original_id);this.recordStat('selected_position',n.index);this.recordStat('selected_with_mouse',n.clicked?1:0);this.recordStat('selected_query',n.query);this._sessionEnd();};m.prototype.bindSessionStart=function(n,event,o){"use strict";if(o)for(var p=0;p<this._sessionStartEvents.length;++p){var q=this._sessionStartEvents[p];q.obj.unsubscribe(q.token);}this._sessionStartEvents.push({obj:n,token:n.subscribe(event,function(r,s){this._sessionStart();}.bind(this))});};m.prototype.bindSessionEnd=function(n,event,o){"use strict";if(o)for(var p=0;p<this._sessionEndEvents.length;++p){var q=this._sessionEndEvents[p];q.obj.unsubscribe(q.token);}this._sessionEndEvents.push({obj:n,token:n.subscribe(event,function(r,s){this._sessionEnd();}.bind(this))});};m.prototype.initEvents=function(){"use strict";this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(n,o){this.recordSelect(o);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(n,o){this.results=o;}.bind(this));this.data.subscribe('beforeQuery',function(n,o){if(!o.value)return;this.query=o.value;this.queriesHistory.add(this.query);if(this.lastNotBackspacedQuery.indexOf(this.query)!==0)this.lastNotBackspacedQuery=this.query;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('beforeFetch',function(n,o){if(o.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else o.fetch_context.queryBegin=Date.now();}.bind(this));this.data.subscribe('fetchComplete',function(n,o){if(o.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);var p={};o.response.payload.entries.forEach(function(q){if(!p[q.type]){p[q.type]=1;}else p[q.type]++;});this.recordStat('bootstrap_response_types',p);this.bootstrapped=true;}else{if('filtered_count' in o.response.payload)this.recordStat('filtered_count',o.response.payload.filtered_count);this.recordAvgStat('avg_query_latency',Date.now()-o.fetch_context.queryBegin);}}.bind(this));this.data.subscribe('respond',function(n,o){var p=this.data.tokenizeBackend(o.value||'').flatValue,q=this.data.findBestPreviousQuery(p,this.data.getQueryIDs())||'',r=this.data.getQueryIDs()[q];this.normalized_backend_query=q;this.request_id=r;this.request_ids.push(r);}.bind(this));this.data.subscribe('dirty',function(n,o){this.bootstrapped=false;}.bind(this));};m.prototype._sessionStart=function(){"use strict";if(this.sessionActive)return;this.sessionActive=true;};m.prototype._sessionEnd=function(){"use strict";if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();};m.prototype.recordStat=function(n,o){"use strict";this.stats[n]=o;};m.prototype.recordCountStat=function(n){"use strict";var o=this.stats[n];this.stats[n]=o?o+1:1;};m.prototype.recordAvgStat=function(n,o){"use strict";if(this.avgStats[n]){this.avgStats[n][0]+=o;++this.avgStats[n][1];}else this.avgStats[n]=[o,1];};m.prototype.hasStats=function(){"use strict";return !!Object.keys(this.stats).length;};m.prototype.submit=function(){"use strict";if(this.hasStats()){j(this.stats,this.extraData);if(this.results){var n=(this.results).map(function(q,r){return q.uid;});this.recordStat('candidate_results',JSON.stringify(n));}if(this.query)this.recordStat('query',this.query);if(this.lastNotBackspacedQuery)this.recordStat('last_not_backspaced_query',this.lastNotBackspacedQuery);this.recordStat('queries_history',JSON.stringify(this.queriesHistory.getQueries()));if(this.normalized_backend_query)this.recordStat('normalized_backend_query',this.normalized_backend_query);if(this.request_id)this.recordStat('request_id',this.request_id);if(this.request_ids.length)this.recordStat('request_ids',this.request_ids);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var o in this.avgStats){var p=this.avgStats[o];this.stats[o]=p[0]/p[1];}new g().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).setErrorHandler(k).send();this._reset();}};m.register=function(n,o,p){"use strict";if(document.activeElement===n){o.init(p);}else var q=h.listen(n,'focus',function(){o.init(p);q.remove();});};j(m.prototype,{endPoint:'/ajax/typeahead/record_basic_metrics.php'});e.exports=m;},null);